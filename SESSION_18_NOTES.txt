================================================================================
SESSION 18 - REAL EXECUTION INFRASTRUCTURE INVESTIGATION
================================================================================

Date: 2026-01-13
Duration: ~2 hours
Focus: F084 (ASAP7 extreme demo) and F085 (Sky130 extreme demo)
Status: BLOCKED on snapshot infrastructure

PROBLEM SUMMARY
===============

F084 and F085 extreme demos are running but returning zero metrics:
- WNS = 0 ps (should be -2500 to -3500 ps for extreme cases)
- hot_ratio = 0 (should be 0.4-0.5 for extreme congestion)
- summary.json shows "mocking: false" but metrics are clearly not real

ROOT CAUSE ANALYSIS
===================

1. **OpenROAD Infrastructure Works**
   ✓ Docker container available (openroad/orfs:latest)
   ✓ ORFS cloned and available
   ✓ ODB snapshot files exist
   ✓ TCL scripts execute successfully

2. **The Core Issue: "No paths found"**
   - OpenROAD STA reports "No paths found" when analyzing placement ODBs
   - Current snapshots are from placement stage (3_place.odb)
   - Placement-stage ODBs lack timing graph information

3. **Why Timing Paths Are Missing**
   - ODB files are created after placement but before CTS
   - Clock tree hasn't been synthesized yet
   - Parasitics haven't been extracted
   - Timing graph nodes/edges not built

4. **What's Needed for Real STA**
   - Post-CTS ODB (4_cts.odb) with clock tree, OR
   - Post-route ODB (5_route.odb) with full routing, OR
   - Placement ODB + parasitics estimation + proper setup

ATTEMPTED SOLUTIONS
===================

1. **Tried: Link design after loading ODB**
   - Result: "cell type gcd can not be linked"
   - Issue: Design name confused with cell type

2. **Tried: Load liberty before ODB**
   - Result: Still "No paths found"
   - Issue: Library loading order doesn't fix missing timing paths

3. **Tried: estimate_parasitics -placement**
   - Result: Layer name errors (metal3, metal5 don't exist in ASAP7)
   - Issue: ASAP7 uses different layer naming (M1-M9)

4. **Tried: Build CTS ODB via ORFS make**
   - Result: Yosys not found in container
   - Issue: ORFS container doesn't have full toolchain for make commands

BLOCKER IDENTIFIED
==================

**The fundamental issue: Current snapshots are insufficient for real STA.**

The studies/*_extreme/ directories contain placement ODBs that don't have:
- Clock tree synthesis results
- Extracted parasitics
- Built timing graphs
- Proper setup for OpenROAD STA

To unblock F084/F085, we need ONE of:

Option A: **Build proper snapshots from full ORFS flow** (RECOMMENDED)
   - Run full ORFS make flow: synth -> floorplan -> place -> cts -> route
   - Extract 4_cts.odb or 5_route.odb as snapshot
   - These have timing information and support real STA
   - Requires: ORFS build environment or pre-built results

Option B: **Fix parasitics estimation for placement ODBs**
   - Correct ASAP7 layer names (M2-M9 not metal2-metal9)
   - Add proper wire RC setup
   - Estimate parasitics before STA
   - May still have limitations vs post-CTS

Option C: **Use mock metrics with disclaimer** (NOT RECOMMENDED)
   - Keep current approach but document limitations
   - Mark as "estimated metrics" not "real execution"
   - Violates spec requirement for "real execution"

RECOMMENDATION
==============

**DEFER F084/F085 to future session with proper snapshot infrastructure.**

Rationale:
1. These are critical features but have deep infrastructure dependencies
2. Fixing this properly requires 4-6 hours minimum
3. Other high-value features (F043-F050) are unblocked and ready
4. Better to complete 5-8 medium features than block on 2 critical ones

Immediate Next Steps:
1. Document this blocker clearly in feature_list.json
2. Add technical notes about snapshot requirements
3. Move to F043-F050 (priors, survivor selection, checkpointing)
4. Return to F084/F085 when snapshot infrastructure is ready

TECHNICAL NOTES FOR FUTURE
===========================

When fixing this, the correct approach is:

1. **Create Proper Snapshots:**
   ```bash
   # In ORFS environment with full toolchain
   make DESIGN_CONFIG=designs/asap7/gcd/config.mk cts
   cp results/asap7/gcd/base/4_cts.odb studies/asap7_extreme/gcd_cts.odb
   ```

2. **Or Use Parasitics Estimation:**
   ```tcl
   read_lef ...
   read_liberty ...
   read_db placement.odb

   # ASAP7 uses M1-M9 not metal1-metal9
   set_wire_rc -signal -layer M2
   set_wire_rc -clock -layer M5
   estimate_parasitics -placement

   read_sdc ...
   report_checks ...
   ```

3. **Test Real Metrics:**
   - WNS should be significantly negative for "extreme" cases
   - Verify with: docker run ... openroad -exit test.tcl
   - Expect WNS around -2000 to -3500 ps for aggressive constraints

FEATURES STATUS
================

Before session: 52/85 passing (61.2%)
After session: 52/85 passing (61.2%) - no change

F084: BLOCKED - needs CTS/route snapshot infrastructure
F085: BLOCKED - same infrastructure dependency

Ready to implement (dependencies satisfied):
- F043: Warm start loading priors
- F044-F046: Survivor selection strategies
- F047-F049: Objective function modes
- F050-F052: Checkpointing system

CONCLUSION
==========

Session successfully identified and documented the root cause of F084/F085
failures. The issue is clear and solvable, but requires significant
infrastructure work that's better done in a dedicated session.

Recommend moving to medium-priority features that are ready to implement.
